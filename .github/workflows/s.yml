name: Send Lichess Messages from list.txt

on:
  workflow_dispatch:
  schedule:
    - cron: "0 * * * *"  # runs every hour (at 00 min)

jobs:
  send_messages:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repo
        uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.10'

      - name: Install dependencies
        run: pip install requests

      # üïí Time check step (cancel if before 18:30 IST, 29 Oct 2025)
      - name: Check time (cancel if before target)
        run: |
          # Convert current UTC time to IST (UTC+5:30)
          current_time=$(date -u '+%s')
          ist_time=$((current_time + 19800))  # +5 hours 30 minutes = 19800 seconds

          # Target: 2025-10-29 18:30 IST ‚Üí in UTC that's 2025-10-29 13:00
          target_epoch=$(date -u -d '2025-10-29 13:00:00' '+%s')

          echo "Current IST time: $(date -u -d @$ist_time)"
          echo "Target IST time:  Wed, 29 Oct 2025 18:30"
          
          if [ "$ist_time" -lt "$target_epoch" ]; then
            echo "‚è≥ Not yet 18:30 IST on 29 Oct 2025 ‚Äî stopping workflow."
            exit 0
          else
            echo "‚úÖ Target time reached, continuing..."
          fi

      - name: Send messages from list.txt
        env:
          BR: ${{ secrets.L }}
        run: |
          while IFS= read -r username; do
            if [ -n "$username" ]; then
              echo "üì® Sending message to $username"
              python -u s.py "$username"
              echo "‚úÖ Done for $username"
              echo "----------------------------------------"
              sleep 3
            fi
          done < list.txt
